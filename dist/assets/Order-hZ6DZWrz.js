import{j as e,d as c,s as l,u as m,V as d,c as b,g as h,L as j}from"./index-BZiLoYku.js";import{A as g}from"./AppLayout-DYW4N5im.js";import{S as N}from"./SetupOrderButton-BtpcmQRF.js";import{u as w}from"./useMutation-DoKyTced.js";function y({data:s}){return e.jsxs("li",{className:"p-2 mt-3 flex flex-wrap justify-between sm:flex-row-reverse items-center  border-b-gray-400 border-b ",children:[e.jsx("div",{className:"mb-2 basis-full sm:basis-auto",children:e.jsxs("span",{className:"text-lg sm:basis-auto block text-right ",children:[s.number," ✖ ",s.pizza_name]})}),e.jsxs("div",{className:"flex justify-between items-center gap-x-4",children:[e.jsx(N,{id:s.id,number:s.number}),e.jsxs("span",{className:"font-bold",children:[s.price*s.number,"$"]})]})]})}function z(){const s=c(r=>r.orderItems.pizzas);return e.jsx("ul",{className:"flex flex-col",children:s.map((r,t)=>e.jsx(y,{data:r},t))})}async function O(s){try{const{data:{user:r},error:t}=await l.auth.getUser();if(t)throw t;const n={user_id:r.id,status:"pending",details:{obj:s}},{data:o,error:a}=await l.from("orders").insert([n]).select();if(a)throw a;return o}catch(r){throw r}}function v(){const s=m(),{mutate:r,isLoading:t}=w({mutationFn:O,onSuccess:n=>{d.success("سفارش با موفقیت ثبت شد"),s(`/order/${n[0].transaction_id}`)},onError:n=>{d.error(n.message),console.log(n)}});return{orderMutate:r,isLoading:t}}function L(){const s=b(),r=c(i=>i.orderItems.pizzas.reduce((f,u)=>f+u.price*u.number,0)),t=c(i=>i.orderItems.pizzas),{orderMutate:n,isLoading:o}=v(),a=m();async function x(){n(t)}function p(){s(h()),a("/menu")}return e.jsxs("div",{className:"flex p-2 mt-2 gap-x-3 items-center justify-center",children:[e.jsxs("button",{onClick:x,disabled:o,className:"bg-yellow-400 rounded-full p-3 font-bold cursor-pointer",children:["پرداخت ",r,"$ و ثبت سفارش"]}),e.jsx("button",{onClick:p,className:"bg-white rounded-full p-3 font-bold cursor-pointer",children:"خالی کردن سبد خرید و برگشت به منو"})]})}function B(){return e.jsx(g,{children:e.jsxs("div",{className:"p-3 font-Vazirmatn ",children:[e.jsx(j,{to:"/menu",className:"text-blue-600 text-right block",children:"برگشت به منو ➡️"}),e.jsx("p",{className:"text-right me-2 mt-3 text-xl",children:"لیست سفارشات شما"}),e.jsx(z,{}),e.jsx(L,{})]})})}export{B as default};
